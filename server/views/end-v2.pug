doctype html

html
  head
    title Task Meow

  body
    script(src="https://statics.teams.cdn.office.net/sdk/v1.9.0/js/MicrosoftTeams.min.js", integrity="sha384-bcRxWKfzRyPxg/waVm3IsOnaH2Inoh5gGIJNOat79+wq22/BZ+mFuSTUmVc7l2el", crossorigin="anonymous")
    script(src="https://alcdn.msauth.net/browser/2.11.0/js/msal-browser.min.js", integrity="sha384-o+Sncs5XJ3NEAeriM/FV8YGZrh7mZk4GfNutRTbYjsDNJxb7caCLeqiDabistgwW", crossorigin="anonymous")

    script.
      microsoftTeams.initialize();

      // Configure MSAL
      const app = new msal.PublicClientApplication({
        auth: {
          clientId:
            window.location.hostname === "taskmeow.com"
              ? "36b1586d-b1da-45d2-9b32-899c3757b6f8"
              : "ab93102c-869b-4d34-a921-a31d3e7f76ef",
          redirectUri: `${window.location.origin}/tab/v2/silent-end`,
          navigateToLoginRequestUrl: false,
        },
        cache: {
          cacheLocation: "localStorage",
        },
      });

      // Handle the callback
      app.handleRedirectPromise
        .then((authResponse) => {
          window.opener &&
            microsoftTeams.authentication.notifySuccess(authResponse);
        })
        .catch((error) => {
          window.opener &&
            microsoftTeams.authentication.notifyFailure(error);
        });