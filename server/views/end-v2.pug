doctype html

html
  head
    title Task Meow

  body
    script(src="https://statics.teams.cdn.office.net/sdk/v1.9.0/js/MicrosoftTeams.min.js", integrity="sha384-bcRxWKfzRyPxg/waVm3IsOnaH2Inoh5gGIJNOat79+wq22/BZ+mFuSTUmVc7l2el", crossorigin="anonymous")
    script(src="https://alcdn.msftauth.net/lib/1.4.5/js/msal.min.js", integrity="sha384-35piYQtnCDJZxSbu/KD/4K6J/5vdITyJkoE5PvyejGRdu7qLGxVudvgODY+6lO6E", crossorigin="anonymous")

    script.
      microsoftTeams.initialize();

      // Configure MSAL
      const app = new Msal.UserAgentApplication({
        auth: {
          clientId:
            window.location.hostname === "taskmeow.com"
              ? "36b1586d-b1da-45d2-9b32-899c3757b6f8"
              : "ab93102c-869b-4d34-a921-a31d3e7f76ef",
          redirectUri: `${window.location.origin}/tab/v2/silent-end`,
          navigateToLoginRequestUrl: false,
        },
        cache: {
          cacheLocation: "localStorage",
        },
      });

      // Handle the callback
      app.handleRedirectCallback((err, response) => {
        if (window.opener) {
          if (err) {
            microsoftTeams.authentication.notifyFailure(err);
          } else {
            microsoftTeams.authentication.notifySuccess();
          }
        }
      });
